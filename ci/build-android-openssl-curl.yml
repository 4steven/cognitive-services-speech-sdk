# Note: this builds both openssl and libcurl; the latter we currently do _not_ use.
pool:
  vmImage: 'Ubuntu 16.04'
steps:
- bash: |
    DOCKER_IMAGE=ubuntu:16.04
    docker pull "$DOCKER_IMAGE" &&
    docker run --rm -i --env _UID=$(id -u) --env _GID=$(id -g) --volume "$(Build.Repository.LocalPath):/csspeech" --workdir /csspeech "$DOCKER_IMAGE" bash - <<"SCRIPT"
      set -e -x -o pipefail
      mkdir androidlibs
      cd androidlibs
      ../ci/build-android-openssl-curl.sh
      chown -R $_UID:$_GID androidlibs
    SCRIPT
    find androidlibs/speechsdkext/openssl_for_ios_and_android/output -type d
  displayName: Build OpenSSL and Curl libraries
- task: PublishBuildArtifacts@1
  displayName: 'Publish artifacts'
  inputs:
    PathtoPublish: 'androidlibs/speechsdkext/openssl_for_ios_and_android/output'
    ArtifactName: output
